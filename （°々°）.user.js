// ==UserScript==
// @name         （°々°）
// @version      1.0
// @description  （°々°） Favorite Script. Use this Script atyour own risk.
// @author       （°々°）
// @match        https://animemusicquiz.com/*
// ==/UserScript==
let save=true;let auto=true;let lastAnswer;if(document.querySelector("#startPage"))return;let savedData=JSON.parse(localStorage.getItem("dbExp"))||{db:[{name:"0",link:"0"}]};let db=savedData.db;new Listener("quiz next video info",(payload)=>{quizVideoController.moePlayers.forEach((moePlayer)=>{let mp3Link=moePlayer.currentVideoUrl.match(/\/([^/]+)\.mp3$/);let videoLink=moePlayer.currentVideoUrl.match(/\/([^/]+)\.webm$/);let matchedObject;if(videoLink&&videoLink.length>1){matchedObject=db.find((obj)=>obj.link===videoLink[1])}if(matchedObject){console.log(matchedObject.name);if(auto&&lastAnswer!==matchedObject.name){autoAnswer(matchedObject.name)}}else if(mp3Link&&mp3Link.length>1){matchedObject=db.find((obj)=>obj.mp3===mp3Link[1]);if(matchedObject){console.log(matchedObject.name);if(auto&&lastAnswer!==matchedObject.name){autoAnswer(matchedObject.name)}}else{console.log("Unknown")}}else{console.log("Unknown")}})}).bindListener();new Listener("answer results",(payload)=>{lastAnswer=payload.songInfo.animeNames.romaji;let catboxLink=payload.songInfo.urlMap.catbox["720"];let catboxMp3=payload.songInfo.urlMap.catbox["0"];if(catboxLink&&typeof catboxLink==="string"){let link=catboxLink.match(/\/([^/]+)\.webm$/);let mp3=catboxMp3.match(/\/([^/]+)\.mp3$/);if(link&&link.length>1&&mp3&&mp3.length>1){link=link[1];mp3=mp3[1];let matchedObject=db.find(obj=>obj.link===link);if(matchedObject&&!matchedObject.mp3){matchedObject.mp3=mp3;if(save)saveSettings()}else if(matchedObject)return;else{db.push({name:payload.songInfo.animeNames.romaji,link:link,mp3:mp3});if(save)saveSettings()}}}}).bindListener();function autoAnswer(answer){let delay=Math.floor(Math.random()*(5500-2500+1))+2500;setTimeout(function(){$("#qpAnswerInput").val(answer);quiz.answerInput.submitAnswer(true)},delay)}function saveSettings(){localStorage.setItem("dbExp",JSON.stringify({db:db}))}let chatBox=document.getElementById("gcInput");chatBox.addEventListener("keydown",function(event){if(event.keyCode===13){let text=chatBox.value.trim();if(text.startsWith("/FEE")){event.preventDefault();exportDbAsJson();chatBox.value=""}else if(text.startsWith("/FEI")){event.preventDefault();let parts=text.split(" ");if(parts.length===2){let link=parts[1].replace("/FEI","");importDbFromJson(link)}chatBox.value=""}}});function exportDbAsJson(){var jsonContent=JSON.stringify(db);var blob=new Blob([jsonContent],{type:"application/json"});var fileName="db.json";if(typeof GM_download==="function"){GM_download(blob,fileName)}else{var a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download=fileName;document.body.appendChild(a);a.click();document.body.removeChild(a)}}function importDbFromJson(link){fetch(link).then(response=>response.json()).then(data=>{if(Array.isArray(data)){db=data;console.log("Import successful.");if(save)saveSettings()}else{console.log("Import failed. Invalid JSON file.")}}).catch(error=>{console.error("Failed to retrieve array from JSON file:",error)})}
